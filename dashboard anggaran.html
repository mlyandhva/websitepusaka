<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard Anggaran - BPS Lamongan</title>

  <!-- Bootstrap & FontAwesome (tetap sama) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />

  <!-- jQuery + DataTables (tetap sama) -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

  <style>
    :root{
      --accent:#6c2bd9;
      --text:#253858;
    }

    html, body {
      height: 100%;
      margin: 0;
      font-family: 'Segoe UI', system-ui, sans-serif;
      color: var(--text);
      background: linear-gradient(
        135deg,
        #ffe5f9 0%,
        #f2f0ff 25%,
        #e9f8ff 50%,
        #faffe8 75%,
        #fff1e6 100%
      );
      background-size: 300% 300%;
      animation: pastelAnim 18s ease infinite;
      display: flex;
      align-items: stretch;
    }

    @keyframes pastelAnim {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .main-content {
      flex-grow: 1;
      padding: 22px;
      overflow-y: auto;
      border-radius: 22px;
      margin: 18px;
      background: linear-gradient(135deg,
        rgba(255, 244, 255, 0.55) 0%,
        rgba(241, 255, 255, 0.45) 40%,
        rgba(255, 250, 240, 0.55) 100%);
      backdrop-filter: blur(8px);
      box-shadow: 0 10px 40px rgba(108,43,217,0.08);
    }

    .navbar-wrapper {
      padding: 10px 14px;
      margin-bottom: 18px;
      border-radius: 14px;
      background: linear-gradient(135deg, rgba(255,250,255,0.6), rgba(235,246,255,0.55));
      border: 1px solid rgba(255,255,255,0.35);
      box-shadow: 0 6px 22px rgba(108,43,217,0.06);
    }

    .navbar-top { 
      display:flex; 
      justify-content:space-between; 
      align-items:center; 
      flex-wrap:wrap; 
      gap:12px; 
    }

    .navbar-title { 
      font-weight:700; 
      color:var(--accent); 
      font-size:20px; 
      margin:0; 
    }

    .navbar-links { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .navbar-links a {
      text-decoration:none;
      color:var(--accent);
      font-weight:600;
      padding:6px 12px;
      border-radius:10px;
      background: rgba(108,43,217,0.06);
      border:1px solid rgba(108,43,217,0.08);
      transition: all 160ms ease;
    }
    .navbar-links a:hover { transform: translateY(-2px); }
    .navbar-links a.active { background:#6a5af9; color: #fff; }

    .charts-container {
      width: 1300px;
      max-width: 100%;
      margin: 6px auto 12px auto;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    .chart-card {
      background: linear-gradient(180deg, rgba(255,245,255,0.7), rgba(245,255,255,0.6));
      border-radius: 12px;
      padding: 10px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.04);
      border: 1px solid rgba(238,238,238,0.8);
      min-height: 280px;
    }

    .chart-iframe { width:100%; height:260px; border:none; border-radius:8px; }

    .pivot-wrapper {
      width: 98%;
      max-width: 1500px;
      margin: 16px auto;
      padding: 14px;
      background: linear-gradient(180deg, rgba(255,243,255,0.65), rgba(245,255,255,0.6));
      border-radius: 14px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.06);
      border: 1px solid rgba(236,236,236,0.9);
    }

    .pivot-wrapper h4 {
      text-align: center;
      width: 100%;
      margin-top: -5px;
      margin-bottom: 15px;
    }

    div.dataTables_filter {
      margin-top: -12px !important;
      margin-bottom: 6px !important;
    }

    table.dataTable thead th {
      background: linear-gradient(90deg, rgba(179,124,255,0.95), rgba(212,152,255,0.9));
      color: #fff;
      font-weight: 700;
      border-bottom: none !important;
    }
    table.dataTable tbody tr:nth-child(even) { background: rgba(251,244,255,0.9); }
    table.dataTable tbody tr:nth-child(odd)  { background: rgba(255,255,255,0.95); }
    table.dataTable tbody tr:hover { background: rgba(243,231,255,0.95); }

  </style>
</head>

<body>

<main class="main-content">
  <div class="navbar-wrapper">
    <div class="navbar-top">

      <!-- âœ” PERBAIKAN: grup logo + PUSAKA agar margin bekerja -->
      <div style="display:flex; align-items:center;">
        <img src="assets/img/logo/logo.png" class="navbar-title" alt="Logo BPS Lamongan" style="height:45px; margin:0; padding:0;">
        <span class="fw-bold fs-4" style="letter-spacing:1px; color:#3A4BFF;">PUSAKA</span>
      </div>

      <div class="navbar-links">
        <a href="index.html">Beranda</a>
        <a href="dashboard-anggaran.html" class="active">Dashboard Anggaran</a>
        <a href="keuangan.html">Keuangan</a>
        <a href="kepegawaian.html">Kepegawaian</a>
        <a href="download.html">Download KAK</a>
        <a href="kalender.html">Kalender Translok</a>
        <a href="kegiatan.html">Kegiatan</a>
      </div>

    </div>
  </div>

  <div class="container">
    <h3 style="color:var(--accent); font-weight:700; text-align:center; margin:6px 0 14px 0;">
      Dashboard Rekap Belanja Anggaran
    </h3>

    
    <div class="charts-container">

      <div class="chart-card">
        <iframe class="chart-iframe"
          src="https://docs.google.com/spreadsheets/d/e/2PACX-1vTYfo9PxkJU6lZmKZu8nlxTXmeoynNYBMgDg5_OI5a5trMF49gpljsfsSZMogS5mwUDnMbW7geDUEMQ/pubchart?oid=972550042&format=interactive"></iframe>
      </div>

      <div class="chart-card">
        <iframe class="chart-iframe"
          src="https://docs.google.com/spreadsheets/d/e/2PACX-1vTYfo9PxkJU6lZmKZu8nlxTXmeoynNYBMgDg5_OI5a5trMF49gpljsfsSZMogS5mwUDnMbW7geDUEMQ/pubchart?oid=1494618085&format=interactive"></iframe>
      </div>

      <div class="chart-card">
        <iframe class="chart-iframe"
          src="https://docs.google.com/spreadsheets/d/e/2PACX-1vTYfo9PxkJU6lZmKZu8nlxTXmeoynNYBMgDg5_OI5a5trMF49gpljsfsSZMogS5mwUDnMbW7geDUEMQ/pubchart?oid=1725657608&format=interactive"></iframe>
      </div>

      <div class="chart-card">
        <iframe class="chart-iframe"
          src="https://docs.google.com/spreadsheets/d/e/2PACX-1vTYfo9PxkJU6lZmKZu8nlxTXmeoynNYBMgDg5_OI5a5trMF49gpljsfsSZMogS5mwUDnMbW7geDUEMQ/pubchart?oid=1742761227&format=interactive"></iframe>
      </div>

    </div>

    <div class="pivot-wrapper" id="pivotWrapper">
      <h4><i class="fa fa-table"></i> Tabel Realisasi Anggaran 2025</h4>

      <table id="pivotTable" class="display stripe hover" style="width:100%">
        <thead id="pivotHead"></thead>
        <tbody id="pivotBody"></tbody>
      </table>
    </div>

  </div>
</main>

    <!-- MENGAMBIL DATA DI SHEET -->
<script>
  const csvUrl =
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vTYfo9PxkJU6lZmKZu8nlxTXmeoynNYBMgDg5_OI5a5trMF49gpljsfsSZMogS5mwUDnMbW7geDUEMQ/pub?gid=1574563910&single=true&output=csv";

  function parseCSV(text) {
    const rows = [];
    let cur = '';
    let row = [];
    let inQuotes = false;

    for (let i = 0; i < text.length; i++) {
      const ch = text[i];
      const next = text[i + 1];

      if (ch === '"') {
        if (inQuotes && next === '"') { cur += '"'; i++; }
        else { inQuotes = !inQuotes; }
        continue;
      }
      if (ch === ',' && !inQuotes) {
        row.push(cur); cur = ''; continue;
      }
      if ((ch === '\n' || ch === '\r') && !inQuotes) {
        if (ch === '\r' && next === '\n') i++;
        row.push(cur); rows.push(row);
        row = []; cur = ''; continue;
      }
      cur += ch;
    }
    if (cur !== '' || row.length > 0) {
      row.push(cur); rows.push(row);
    }
    return rows;
  }

  function escapeHtml(s) {
    if (s === null || s === undefined) return '';
    return s.toString()
      .replace(/&/g,'&amp;')
      .replace(/</g,'&lt;')
      .replace(/>/g,'&gt;');
  }

  async function loadAndInitTable() {
    try {
      const res = await fetch(csvUrl);
      if (!res.ok) throw new Error("Gagal mengambil CSV");

      const text = await res.text();
      const rows = parseCSV(text);

      const header = rows[0];
      let headHTML = "<tr>";
      header.forEach(h => headHTML += `<th>${escapeHtml(h)}</th>`);
      headHTML += "</tr>";
      document.querySelector("#pivotHead").innerHTML = headHTML;

      let bodyHTML = "";
      for (let i = 1; i < rows.length; i++) {
        const r = rows[i];
        if (r.every(c => c.trim() === "")) continue;

        bodyHTML += "<tr>";
        r.forEach(c => bodyHTML += `<td>${escapeHtml(c)}</td>`);
        bodyHTML += "</tr>";
      }
      document.querySelector("#pivotBody").innerHTML = bodyHTML;

      $("#pivotTable").DataTable({
        pageLength: 25,
        responsive: true,
        autoWidth: false,
        language: {
          search: "Cari:",
          lengthMenu: "Tampilkan _MENU_ baris",
          info: "Menampilkan _START_ sampai _END_ dari _TOTAL_ baris",
          paginate: { previous: "Sebelumnya", next: "Berikutnya" },
          zeroRecords: "Tidak menemukan data"
        }
      });

    } catch (e) {
      document.querySelector("#pivotBody").innerHTML =
        `<tr><td>Error memuat CSV: ${e}</td></tr>`;
    }
  }

  loadAndInitTable();
</script>

</body>
</html>
