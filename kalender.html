<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Kalender Translok - PUSAKA</title>

    <!-- ===========================
         FONT & ICONS
         - Google Fonts Poppins
         - Font Awesome untuk ikon
         ============================ -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

    <!-- ===========================
         BOOTSTRAP CSS
         - Untuk modal, tombol, responsivitas
         ============================ -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- ===========================
         FULLCALENDAR CSS
         - Styling kalender
         ============================ -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" rel="stylesheet" />

    <!-- ===========================
         CUSTOM CSS
         - Styling navbar, grid, card, kalender, warna
         ============================ -->
    <style>
      :root {
       body {
           background: linear-gradient(135deg, #a5bcc9, #b9859b);
      }

      }

      /* Reset semua elemen */
      * { box-sizing: border-box; }

      /* Body & font */
      body {
    font-family: "Poppins", sans-serif;
    background:#ffffff !important;
    color:#222 !important;
    margin:0;
    min-height:100vh;
  }

     
      /* ===========================
   NAVIGATION BAR (STYLE BARU)
   =========================== */

    /* ================= NAVBAR STYLING BARU ================= */

.navbar-wrapper {
  background: rgba(255, 255, 255, 0.6);
  backdrop-filter: blur(12px);
  border-radius: 15px;
  padding: 8px 16px;
  margin: 20px auto 20px;
  width: calc(100% - 40px);
  max-width: 1400px;
  box-shadow: 0 4px 15px rgba(108, 43, 217, 0.08);
}

.navbar-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  white-space: nowrap;
  gap: 12px;
}

.navbar-links {
  display: flex;
  flex-wrap: nowrap;
  gap: 6px;
}

/* NAV ITEMS */
.navbar-links a {
  padding: 6px 12px;
  font-size: 14px;
  font-weight: 600;
  text-decoration: none;
  color: #7a3dff;
  border-radius: 10px;
  background: rgba(122, 61, 255, 0.08);
  border: none;
  transition: .2s;
  white-space: nowrap;
}

.navbar-links a:hover {
  transform: translateY(-2px);
  background: rgba(122, 61, 255, 0.15);
}

.navbar-links a.active {
  background: #6A5AF9;
  color: white !important;
  font-weight: 700;
  box-shadow: 0 4px 14px rgba(106, 90, 249, 0.26);
}

/* LOGO & TITLE */
.navbar-logo-title img {
  height: 38px;
}

.navbar-logo-title span {
  font-size: 22px;
  font-weight: 800;
  color: #3A4BFF;
}


      /* ===========================
         PAGE TITLE
         ============================ */
       h1.title {
    margin-top:10px;
    text-align:center;
    font-size:28px;
    font-weight:700;
    color:#c08989 !important;
  } /* ===========================
         jarak navbar degan isi halaaman
         ============================ */

      /* ===========================
         DASHBOARD GRID
         - Responsive 2 kolom di desktop
         ============================ */
      .dashboard {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
        width: 95%;
        max-width: 1320px;
        margin: 30px auto 80px;
      }
      @media (min-width: 992px) { .dashboard { grid-template-columns: 2fr 1fr; } }

      /* ===========================
         CARD CUSTOM
         - Blur, border-radius, shadow
         ============================ */
      .card-custom {
        backdrop-filter: blur(8px);
        border-radius: 20px;
        padding: 22px;
        color: #c08989;
        box-shadow: 0 10px 30px rgba(0,0,0,0.20);
      }

      /* Overview kalender span full width */
      .overview { grid-column: 1 / -1; background: linear-gradient(135deg, rgba(255,255,255,0.06), rgba(0,0,0,0.05)); }

      /* ===========================
         FULLCALENDAR STYLING
         ============================ */
      #calendar { background: rgba(255,255,255,0.06); padding:10px; border-radius:12px; }
      .fc-toolbar-title { color: #4972e2 !important; font-weight:700; }
      .fc-button {
        background: #4972e2 !important;
        color: var(--purple-1) !important;
        border: none !important;
        border-radius: 8px !important;
        padding: 6px 10px !important;
      }
                /* Animasi hover tombol FullCalendar */
        .fc-button {
          transition: all 0.25s ease !important; /* smooth animasi */
        }

        .fc-button:hover {
          background: #4972e2 !important;  /* biru */
          color: #ffffff !important;        /* teks putih */
          transform: translateY(-3px);      /* tombol naik */
          box-shadow: 0 6px 12px rgba(0,0,0,0.15); /* efek timbul */
        }

        
      /* Spacer supaya konten tidak tertutup navbar */
      .spacer { height: 6px; }
      @media (min-width: 992px) { .spacer { height: 18px; } }
    </style>
  </head>

  <body>
    <!-- ===========================
         NAVBAR
         - Logo, judul aplikasi, menu navigasi
         - Menu aktif: Kalender Translok
         ============================ -->
   <div class="navbar-wrapper">
  <div class="navbar-top">

    <!-- LOGO + TITLE -->
    <div class="navbar-logo-title" style="display:flex; align-items:center; gap:8px;">
      <img src="assets/img/logo/logo.png" alt="Logo">
      <span>PUSAKA</span>
    </div>

    <!-- MENU -->
    <div class="navbar-links">
      <a href="index.html">Beranda</a>
      <a href="dashboard anggaran.html">Dashboard Anggaran</a>
      <a href="keuangan.html">Keuangan</a>
      <a href="kepegawaian.html">Kepegawaian</a>
      <a href="download.html">Download KAK</a>
      <a href="kalender.html" class="active">Kalender Translok</a>
      <a href="kegiatan.html">Kegiatan</a>
    </div>

  </div>
</div>

  <div class="container">
    <h3 style="color:var(--accent); font-weight:700; text-align:center; margin:6px 0 14px 0;">
    <!-- Spacer -->
    <div class="spacer"></div>

    <!-- ===========================
         TITLE HALAMAN
         ============================ -->
    <h1 class="title">Kalender Translok - PUSAKA</h1>

    <!-- ===========================
         DASHBOARD GRID
         - Kiri: kalender overview
         - Kanan: card info/cetak
         ============================ -->
    <div class="dashboard container-fluid">
      <!-- CARD KALENDER -->
      <div class="card-custom overview">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4 class="fw-bold mb-0"><i class="fa-solid fa-calendar-days me-2"></i>Kalender Translok</h4>
          <div>
          <!-- <button id="clearAllBtn" class="btn btn-sm"  -->
  <!-- <i class="fa-solid fa-trash"></i> Hapus Semua -->
</button>

<button id="exportBtn" class="btn btn-sm" 
        style="background:#b79696;color:#ffffff;font-weight:600;border-radius:10px;" 
        title="Export Excel">
  <i class="fa-solid fa-file-export"></i> Export
</button>

          </div>
        </div>
        <div id="calendar"></div>
      </div>

      <!-- CARD APP -->
      <div class="card-custom card-small">
        <div class="d-flex gap-3 align-items-start">
          <img src="assets/img/clients/cetakspk.png" alt="cetak spk" style="width: 140px;" class="img-fluid rounded shadow-sm">
          <div class="flex-grow-1">
            <h5 class="fw-bold">CETAK SPK â€“ BAST</h5>
            <p style="color: #c08989; margin-bottom:6px;">
              Surat Perjanjian Kerja dan BAST dengan mitra statistik dicatat disini
              dan dapat dicetak langsung melalui mekanisme mail merge.
            </p>
            <a href="https://docs.google.com/spreadsheets/d/1LMiNMqC8m_a-T37CSTakVJzjKoBNuktscAhucovR9Ho/edit?usp=sharing"
               target="_blank" rel="noopener" class="btn btn-custom" style="background:#b79696;color:#ffffff;font-weight:600;border-radius:20px;">
              <i class="fa-solid fa-print me-2"></i>Aplikasi
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- ===========================
         MODAL TAMBAH EVENT
         - Input keterangan
         - Bisa input panjang
         - Simpan ke tanggal yg diklik
         ============================ -->
    <div class="modal fade" id="addEventModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content text-dark">
          <div class="modal-header">
            <h5 class="modal-title">Tambah Keterangan</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
          </div>
          <div class="modal-body">
            <label class="mb-1">Isi Keterangan</label>
            <textarea id="eventText" class="form-control" rows="3" placeholder="Contoh: Survey lapangan - Tim A (09:00 - 15:00)"></textarea>
            <input type="hidden" id="eventDate">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
            <button id="saveEventBtn" type="button" class="btn btn-primary">Simpan</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ===========================
         SCRIPTS
         - Bootstrap JS
         - FullCalendar JS
         - XLSX untuk export Excel
         - Custom JS: tambah/hapus/simpan/export event
         ============================ -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
      // ===========================
      // CONSTANTS & HELPERS
      // ===========================
      const STORAGE_KEY = "pusaka_translok_events_v1";

      function loadSavedEvents() {
        try { 
          const raw = localStorage.getItem(STORAGE_KEY); 
          return raw ? JSON.parse(raw) : []; 
        } catch(e){ 
          return []; 
        }
      }

      function saveEvents(arr){
        try { localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); } catch(e){}
      }

      function generateId(){ 
        return Date.now() + "-" + Math.floor(Math.random()*1000000); 
      }

      // ===========================
      // Membuat kalender full
      // ===========================
      document.addEventListener("DOMContentLoaded", function () {
        let savedEvents = loadSavedEvents();
        const calendarEl = document.getElementById("calendar");

        const calendar = new FullCalendar.Calendar(calendarEl,{
          initialView:"dayGridMonth", 
          locale:"id", 
          selectable:true, 
          editable:true, 
          height:650,
          headerToolbar:{
            left:"prev,next today",
            center:"title",
            right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"
          },
          events:savedEvents,

          // ===========================
          // DATECLICK: tambah keterangan baru
          // ===========================
          dateClick:function(info){
            document.getElementById("eventDate").value = info.dateStr;
            document.getElementById("eventText").value = "";
            const modal = new bootstrap.Modal(document.getElementById("addEventModal")); 
            modal.show();
          },

          // ===========================
          // EVENTCLICK: hapus event
          // ===========================
          // eventClick:function(info){
            // if(confirm("Hapus keterangan '" + info.event.title + "'?")){
              // const evId = info.event.id;
              // info.event.remove();
              // savedEvents = savedEvents.filter(e=>e.id!==evId); 
              // saveEvents(savedEvents);
          

          // ===========================
          // EVENTCHANGE: drag & resize
          // ===========================
          eventChange:function(changeInfo){
            const ev = changeInfo.event;
            const idx = savedEvents.findIndex(e=>e.id===ev.id);
            if(idx!==-1){
              savedEvents[idx].start = ev.start?ev.start.toISOString():savedEvents[idx].start;
              savedEvents[idx].end = ev.end?ev.end.toISOString():null;
              savedEvents[idx].allDay = ev.allDay; 
              savedEvents[idx].title = ev.title; 
              saveEvents(savedEvents);
            } else {
              savedEvents.push({
                id:ev.id||generateId(),
                title:ev.title,
                start:ev.start?ev.start.toISOString():null,
                end:ev.end?ev.end.toISOString():null,
                allDay:ev.allDay
              });
              saveEvents(savedEvents);
            }
          }
        });

        calendar.render();

        // ===========================
        // SIMPAN EVENT DARI MODAL
        // ===========================
        document.getElementById("saveEventBtn").addEventListener("click",function(){
          const text=document.getElementById("eventText").value.trim();
          const date=document.getElementById("eventDate").value;
          if(!text) return;
          const ev={id:generateId(),title:text,start:date,allDay:true};
          calendar.addEvent(ev); savedEvents.push(ev); saveEvents(savedEvents);
          const modalEl=document.getElementById("addEventModal"); 
          const modalInstance=bootstrap.Modal.getInstance(modalEl); 
          if(modalInstance) modalInstance.hide();
        });

        // ===========================
        // HAPUS SEMUA EVENT
        // ===========================
        // document.getElementById("clearAllBtn").addEventListener("click",function(){
          // if(!confirm("Yakin ingin menghapus semua event dari kalender?")) return;
          // calendar.getEvents().forEach(ev=>ev.remove());
          // savedEvents=[]; saveEvents(savedEvents); 
          // alert("Semua event telah dihapus.");
        });

        // ===========================
        // EXPORT KE EXCEL
        // ===========================
        document.getElementById("exportBtn").addEventListener("click",function(){
          if(savedEvents.length===0){ alert("Tidak ada event untuk diekspor."); return; }
          const worksheet=XLSX.utils.json_to_sheet(savedEvents);
          const workbook=XLSX.utils.book_new(); 
          XLSX.utils.book_append_sheet(workbook,worksheet,"Kalender");
          XLSX.writeFile(workbook,"kalender-translok.xlsx");
        });

        // ===========================
        // STORAGE SYNC: jika berubah di tab lain
        // ===========================
        window.addEventListener("storage",function(e){
          if(e.key===STORAGE_KEY){
            const fresh=loadSavedEvents();
            calendar.getEvents().forEach(ev=>ev.remove());
            fresh.forEach(ev=>calendar.addEvent(ev));
            savedEvents=fresh;
          }
        });
    </script>
  </body>
</html>
